<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>å¸å®‰ Web3 é’±åŒ…ç¬¬22æœŸ IDO ä¸Šçº¿ ($IDOL)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body{
      font-family:"Segoe UI","PingFang SC","Microsoft YaHei",sans-serif;
      background:#f0f2f5;margin:0;padding:0
    }
    .container{
      max-width:640px;margin:40px auto;background:#fff;
      padding:30px;border-radius:16px;box-shadow:0 8px 20px rgba(0,0,0,.08)
    }
    h2{color:#0078d4;text-align:center;margin-bottom:25px}
    label{display:block;margin:16px 0 6px;font-weight:700;color:#333}
    input,select{
      width:100%;padding:10px;font-size:15px;border:1px solid #ccc;
      border-radius:8px;box-sizing:border-box
    }
    button{
      width:100%;padding:12px;font-size:16px;background:#0078d4;color:#fff;
      border:none;border-radius:8px;margin-top:20px;cursor:pointer;
      transition:background-color .2s
    }
    button:hover{background:#005fa3}

    /* è¿›åº¦æ¡ä¸ç»“æœåŒº */
    .progress-container{margin-top:30px}
    .progress-bg{background:#eee;height:14px;border-radius:8px;overflow:hidden}
    .progress-bar{background:#0078d4;height:100%;width:0%;transition:width .5s}
    .countdown{text-align:right;margin-top:5px;font-size:14px;color:#888}
    .result{
      background:#f9fafb;margin-top:30px;padding:20px;border-radius:12px;
      border:1px solid #ddd
    }
    .result p{margin:10px 0;font-size:15px}
    .highlight{color:#d32f2f;font-weight:700}
    .success{color:#2e7d32;font-weight:700}

    /* é“¾æ¥æŒ‰é’®ç»Ÿä¸€æ ·å¼ */
    .tutorial-link{
      display:block;text-align:center;margin-top:15px;font-weight:700;
      text-decoration:none;color:#0078d4
    }
    .tutorial-link:hover{text-decoration:underline}

    .updateHint{text-align:right;font-size:13px;color:#666;margin-top:8px}
  </style>
</head>
<body>
  <div class="container">
    <h2>å¸å®‰ Web3 é’±åŒ…ç¬¬22æœŸ IDO ä¸Šçº¿ ($IDOL)</h2>

    <label>é€‰æ‹©ä»£å¸</label>
    <select id="tokenSelect">
      <option value="IDOL">IDOL</option>
    </select>

    <!-- ä¸»æ± åœ°å€ -->
    <input id="targetAddress" style="display:none"
           value="0xa060cccc78e44bf94081d32a08bbea90face512e"/>

    <label>æŠ•å…¥ BNB</label>
    <input id="userAmount" type="number" step="0.01" value="3"/>

    <label>ä»£å¸å•ä»·ï¼ˆå•ä½ï¼šUSDï¼Œå¯è‡ªå®šä¹‰ä¿®æ”¹ï¼Œé»˜è®¤ 0.02083ï¼‰</label>
    <input id="tokenPrice" type="number" step="0.00001" value="0.02083"/>

    <button id="refreshBtn" onclick="manualRefresh()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    <div class="updateHint" id="lastUpdateHint">â€”</div>

    <!-- æ•™ç¨‹ä¸ä½œè€…æ¨ç‰¹ä¸‰ä¸ªé“¾æ¥ -->
    <a class="tutorial-link"
       href="https://x.com/0xXIAOc/status/1932680505620902193" target="_blank">
      ğŸ“˜ æå‰æˆæƒ IDOL æ•™ç¨‹å…¥å£
    </a>
    <a class="tutorial-link"
       href="https://x.com/0xXIAOc/status/1929136552757830056" target="_blank">
      ğŸ’¸ å€Ÿ BNB æ•™ç¨‹å…¥å£
    </a>
    <a class="tutorial-link"
       href="https://x.com/0xXIAOc" target="_blank">
      ğŸ¦ ä½œè€…æ¨ç‰¹ @0xXIAOc
    </a>

    <!-- è¿›åº¦æ¡åŒº -->
    <div class="progress-container">
      <div class="progress-bg">
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="countdown" id="countdownText">å€’è®¡æ—¶åŠ è½½ä¸­â€¦</div>
    </div>

    <!-- ç»“æœæ˜¾ç¤ºåŒº -->
    <div class="result" id="resultBox" style="display:none">
      <p>ğŸ“¦ å½“å‰åœ°å€ BNB ä½™é¢ï¼š<span class="highlight" id="bnbBalance"></span></p>
      <p>ğŸ¯ å‹Ÿé›†ç›®æ ‡ï¼š<span id="targetShow">300.32 BNB</span></p>
      <p>ğŸ”¥ è¶…å‹Ÿå€æ•°ï¼š<span class="highlight" id="multiplier">â€”</span></p>
      <p>ğŸ’° æ€»é”€å”®é‡ï¼š96,000,000 IDOL</p>
      <hr>
      <p>
        ğŸš€ ä½ æŠ•å…¥ <span class="highlight" id="userInput"></span> BNB
        ï¼ˆå æ¯” <span class="highlight" id="percent"></span>%ï¼‰<br>
        å¯è·å¾— <span class="success" id="cudisAmount"></span> æš IDOL
        â‰ˆ <span class="success" id="usdValue"></span> USD
      </p>
    </div>
  </div>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å…¨å±€å¸¸é‡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const CONFIG = {
  TOTAL_TARGET_BNB : 300.32,
  TOTAL_TOKENS     : 96_000_000,
  START_TIME       : new Date('2025-06-11T16:00:00+08:00'),
  END_TIME         : new Date('2025-06-11T18:00:00+08:00'),
  REFRESH_INTERVAL_MS : 60_000,
  RPC_NODES : [
    'https://bsc-dataseed.binance.org/',
    'https://bsc-dataseed1.defibit.io/',
    'https://bsc-dataseed1.ninicoin.io/'
  ]
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DOM ç¼“å­˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const els = {
  targetAddress : document.getElementById('targetAddress'),
  userAmount    : document.getElementById('userAmount'),
  tokenPrice    : document.getElementById('tokenPrice'),
  bnbBalance    : document.getElementById('bnbBalance'),
  multiplier    : document.getElementById('multiplier'),
  userInput     : document.getElementById('userInput'),
  percent       : document.getElementById('percent'),
  cudisAmount   : document.getElementById('cudisAmount'),
  usdValue      : document.getElementById('usdValue'),
  resultBox     : document.getElementById('resultBox'),
  countdownText : document.getElementById('countdownText'),
  progressBar   : document.getElementById('progressBar'),
  refreshBtn    : document.getElementById('refreshBtn'),
  lastUpdateHint: document.getElementById('lastUpdateHint'),
  targetShow    : document.getElementById('targetShow')
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å·¥å…·å‡½æ•° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const formatWeiToBNB = (weiBig) =>{
  const intPart  = (weiBig / 10n**18n).toString();
  const fracPart = (weiBig % 10n**18n).toString().padStart(18,'0').slice(0,4);
  return `${intPart}.${fracPart}`.replace(/\.?0+$/,'');
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RPC æŸ¥è¯¢ï¼ˆå¸¦å…œåº•ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function fetchBalanceWithFallback(address){
  for(const rpc of CONFIG.RPC_NODES){
    try{
      const controller = new AbortController();
      const timeout = setTimeout(()=>controller.abort(), 7_000);
      const res = await fetch(rpc,{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          jsonrpc:'2.0',
          method :'eth_getBalance',
          params :[address,'latest'],
          id     :1
        }),
        signal:controller.signal
      });
      clearTimeout(timeout);
      if(!res.ok) throw new Error(`HTTP ${res.status}`);
      const data = await res.json();
      if(data.result) return BigInt(data.result);
    }catch(e){
      console.warn(`âš  èŠ‚ç‚¹ ${rpc} å¤±è´¥ï¼š`,e.message);
    }
  }
  throw new Error('æ‰€æœ‰ RPC èŠ‚ç‚¹å‡ä¸å¯ç”¨');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æ›´æ–°ä½™é¢ & è®¡ç®—åˆ†é… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function updateBalanceAndCalc(){
  if(Date.now() >= CONFIG.END_TIME) return;          // ç»“æŸååœæ­¢åˆ·æ–°

  const address   = els.targetAddress.value.trim();
  const userInput = parseFloat(els.userAmount.value);
  const price     = parseFloat(els.tokenPrice.value);
  if(!address || isNaN(userInput)||userInput<=0||isNaN(price)||price<=0){
    alert('è¯·è¾“å…¥æœ‰æ•ˆæŠ•å…¥é‡‘é¢å’Œä»£å¸å•ä»·');return;
  }

  try{
    els.refreshBtn.disabled=true;els.refreshBtn.textContent='â³ åˆ·æ–°ä¸­â€¦';

    const wei        = await fetchBalanceWithFallback(address);
    const bnbStr     = formatWeiToBNB(wei);
    const deposited  = parseFloat(bnbStr);

    /* â€”â€” 1. æ˜¾ç¤ºé“¾ä¸Šä½™é¢ & å€æ•° â€”â€” */
    els.bnbBalance.textContent = `${bnbStr} BNB`;
    const multiple = deposited / CONFIG.TOTAL_TARGET_BNB;
    els.multiplier.textContent = multiple.toFixed(2);
    els.targetShow.textContent = `${CONFIG.TOTAL_TARGET_BNB} BNB`;

    /* â€”â€” 2. ç”¨æˆ·ä»½é¢ã€å æ¯”ã€é¢„è®¡ Token â€”â€” */
    const share   = deposited>0 ? userInput / deposited : 0;
    const tokens  = share * CONFIG.TOTAL_TOKENS;
    els.percent.textContent     = (share*100).toFixed(4);
    els.cudisAmount.textContent = tokens.toFixed(2);
    els.usdValue.textContent    = (tokens * price).toFixed(2);
    els.userInput.textContent   = userInput.toFixed(2);

    els.resultBox.style.display = 'block';

    /* â€”â€” 3. æ›´æ–°æ—¶é—´æç¤º â€”â€” */
    const t = new Date();
    els.lastUpdateHint.textContent =
      `æœ€åæ›´æ–°æ—¶é—´ï¼š${t.toLocaleTimeString('zh-CN',{hour12:false})}`;
  }catch(err){
    console.error(err);
    alert(`æŸ¥è¯¢å¤±è´¥ï¼š${err.message}`);
  }finally{
    els.refreshBtn.disabled=false;
    els.refreshBtn.textContent='ğŸ”„ åˆ·æ–°æ•°æ®';
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å€’è®¡æ—¶ & è¿›åº¦æ¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateCountdown(){
  const now = Date.now();
  if(now < CONFIG.START_TIME){
    els.countdownText.textContent='æ´»åŠ¨æœªå¼€å§‹';
    els.progressBar.style.width='0%';
  }else if(now >= CONFIG.END_TIME){
    els.countdownText.textContent='å·²ç»“æŸ';
    els.progressBar.style.width='100%';

    /* â€”â€” åœæ­¢æ‰€æœ‰å®šæ—¶å™¨ï¼Œå†»ç»“é¡µé¢æ•°æ® â€”â€” */
    clearInterval(balanceTimer);
    clearInterval(countdownTimer);
    els.refreshBtn.disabled = true;
    els.refreshBtn.textContent = 'â¹ å·²ç»“æŸ';
  }else{
    const diff = CONFIG.END_TIME - now;
    const h    = Math.floor(diff/36e5);
    const m    = Math.floor((diff%36e5)/6e4);
    els.countdownText.textContent=`å‰©ä½™æ—¶é—´ï¼š${h}å°æ—¶ ${m}åˆ†`;

    const pct  = ((now - CONFIG.START_TIME) /
                 (CONFIG.END_TIME - CONFIG.START_TIME) * 100).toFixed(2)+'%';
    els.progressBar.style.width=pct;
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ åˆå§‹åŒ– â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function manualRefresh(){ updateBalanceAndCalc(); }

let balanceTimer, countdownTimer;

window.addEventListener('load',()=>{
  updateBalanceAndCalc();
  updateCountdown();
  balanceTimer   = setInterval(updateBalanceAndCalc, CONFIG.REFRESH_INTERVAL_MS);
  countdownTimer = setInterval(updateCountdown, 1_000);
});
</script>
</body>
</html>
