<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>å¸å®‰Â Web3Â é’±åŒ…Â ç¬¬äºŒæœŸé¢„å”®Â ($BAS)</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<meta name="color-scheme" content="light dark">
<style>
:root{
  --c-bg:#f9f9f9;--c-card:#fff;--c-text:#222;--c-sub:#6b7280;
  --c-primary:#0078d4;--c-primary-dark:#005fa3;--c-success:#16a34a;
  --c-error:#dc2626;--c-refund:#0284c7;--c-warn:#f59e0b;
}
@media(prefers-color-scheme:dark){
  :root{--c-bg:#111827;--c-card:#1f2937;--c-text:#f3f4f6;--c-sub:#9ca3af}
}
*{box-sizing:border-box}
body{
  margin:0;font-family:-apple-system,Segoe UI,PingFang SC,Helvetica,Arial,sans-serif;
  background:var(--c-bg);color:var(--c-text)
}
.container{
  max-width:660px;margin:40px auto;background:var(--c-card);
  padding:34px;border-radius:18px;box-shadow:0 10px 24px rgba(0,0,0,.08)
}
h2{color:var(--c-primary);text-align:center;margin-bottom:28px}
label{display:block;margin:18px 0 8px;font-weight:700;color:var(--c-text)}
.note{font-size:13px;color:var(--c-sub);font-weight:400;margin-left:4px}
input,select{
  width:100%;padding:12px;font-size:15px;border:1px solid #ccc;
  border-radius:10px;background:var(--c-card);color:var(--c-text)
}
button{
  width:100%;padding:13px;font-size:16px;background:var(--c-primary);color:#fff;
  border:none;border-radius:10px;margin-top:24px;cursor:pointer;
  transition:background-color .2s
}
button:hover{background:var(--c-primary-dark)}
.progress-container{margin-top:34px}
.progress-bg{background:#e5e7eb;height:14px;border-radius:10px;overflow:hidden}
.progress-bar{background:var(--c-primary);height:100%;width:0%;transition:width .4s}
.countdown{text-align:right;margin-top:6px;font-size:14px;color:var(--c-sub)}
.result{
  background:var(--c-bg);margin-top:34px;padding:22px;border-radius:14px;
  border:1px solid #d1d5db
}
.result p{margin:10px 0;font-size:15px;line-height:1.45}
.highlight{font-weight:700}
.success{color:var(--c-success);font-weight:700}
.deduct{color:var(--c-error);font-weight:700}
.refund{color:var(--c-refund);font-weight:700}
.tutorial-link{
  display:block;text-align:center;margin-top:18px;font-weight:700;
  text-decoration:none;color:var(--c-primary)
}
.tutorial-link:hover{text-decoration:underline}
.updateHint{text-align:right;font-size:13px;color:var(--c-sub);margin-top:10px}
.error-banner{
  display:none;padding:10px 14px;margin-bottom:18px;background:var(--c-error);
  color:#fff;border-radius:10px;font-size:14px
}
</style>
</head>
<body>
<div class="container">
  <div id="errBanner" class="error-banner"></div>

  <h2>å¸å®‰Â Web3Â é’±åŒ…Â ç¬¬äºŒæœŸé¢„å”®Â ($BAS)</h2>

  <label>é€‰æ‹©ä»£å¸</label>
  <select id="tokenSelect"><option value="BAS">BAS</option></select>

  <!-- é¡¹ç›®å‹Ÿé›†åœ°å€ -->
  <input id="targetAddress" type="hidden" value="0x1057a8673787856e4082b83e88ec9acb1f6c932a">

  <label>æŠ•å…¥ BNB</label>
  <input id="userAmount" type="number" step="0.01" value="3" min="0">

  <label>é¢„è®¡ç©ºæŠ•æ€»é¢Â (USD)<span class="note">å¯è‡ªå¡«ï¼›é»˜è®¤Â 200Â ä¸‡</span></label>
  <input id="airdropUSD" type="number" step="10000" value="2000000" min="0" oninput="autoPrice()">
  <div class="note" id="airdropFmt">â‰ˆÂ 200â€¯ä¸‡Â USD</div>

  <label>ä»£å¸å•ä»·Â (USD)<span class="note">ç³»ç»Ÿè‡ªåŠ¨æ¨ç®—ï¼Œå¯æ‰‹åŠ¨è°ƒæ•´</span></label>
  <input id="tokenPrice" type="number" step="0.00001" value="0.01" min="0">

  <!-- BNB ç°ä»·ï¼Œè‡ªåŠ¨æ‹‰å–ï¼›fallback é»˜è®¤ä¸ºÂ 600 -->
  <input id="bnbPrice" type="number" value="600" style="display:none">

  <button id="refreshBtn">ğŸ”„Â åˆ·æ–°æ•°æ®</button>
  <div class="updateHint" id="lastUpdateHint">â€”</div>

  <a class="tutorial-link" href="https://x.com/0xXIAOc" target="_blank">ğŸ¦Â ä½œè€…æ¨ç‰¹Â @0xXIAOc</a>

  <div class="progress-container">
    <div class="progress-bg"><div class="progress-bar" id="progressBar"></div></div>
    <div class="countdown" id="countdownText">å€’è®¡æ—¶åŠ è½½ä¸­â€¦</div>
  </div>

  <div class="result" id="resultBox" style="display:none">
    <p>ğŸ“¦Â å½“å‰åœ°å€Â BNBÂ ä½™é¢ï¼š<span class="highlight" id="bnbBalance">â€”</span></p>
    <p>ğŸ¯Â å‹Ÿé›†ç›®æ ‡ï¼š278.74176Â BNB</p>
    <p>ğŸ”¥Â è¶…å‹Ÿå€æ•°ï¼š<span class="highlight" id="multiplier">â€”</span></p>
    <p>ğŸ’°Â æ€»é”€å”®é‡ï¼š200Â 000Â 000Â æšÂ BAS</p><hr>
    <p>ğŸš€Â ä½ æŠ•å…¥Â <span class="highlight" id="userInput">â€”</span>Â BNBï¼ˆå æ¯”Â <span class="highlight" id="percent">â€”</span>%ï¼‰<br>
       å¯è·å¾—Â <span class="success" id="basAmount">â€”</span>Â æšÂ BASÂ â‰ˆÂ <span class="success" id="usdValue">â€”</span></p>
    <p>ğŸ’¸Â å®é™…æ‰£æ¬¾ï¼š<span class="deduct" id="principalBNB">â€”</span>Â BNBÂ â‰ˆÂ <span class="deduct" id="principalUSD">â€”</span></p>
    <p>ğŸ”„Â é€€å›Â BNBï¼š<span class="refund" id="refundBNB">â€”</span>Â BNB</p>
  </div>
</div>

<script>
/* ==== é…ç½®åŒº ==== */
const CONFIG={
  TOTAL_TARGET_BNB:278.74176,
  TOTAL_TOKENS:200_000_000,
  START_TIME:new Date('2025-07-17T16:00:00+08:00'),
  END_TIME:new Date('2025-07-17T18:00:00+08:00'),
  REFRESH_INTERVAL:20_000,
  PRICE_CACHE_MS:60_000,
  RPC_NODES:[
    'https://bsc-dataseed.binance.org/',
    'https://bsc-dataseed1.defibit.io/',
    'https://bsc-dataseed4.defibit.io/',
    'https://bsc-dataseed1.ninicoin.io/'
  ]
};
/* ==== å·¥å…·å‡½æ•° ==== */
const $=id=>document.getElementById(id);
const els=['userAmount','tokenPrice','airdropUSD','airdropFmt','bnbPrice','bnbBalance','multiplier','userInput','percent',
'basAmount','usdValue','principalBNB','principalUSD','refundBNB',
'resultBox','countdownText','progressBar','refreshBtn','lastUpdateHint','targetAddress','errBanner']
.reduce((o,i)=>(o[i]=$(i),o),{});
const fmt=(n,d=0)=>Number(n).toLocaleString(undefined,{maximumFractionDigits:d});
const fetchJSON=(u,o)=>fetch(u,o).then(r=>r.json());

/* è‡ªåŠ¨è®¡ç®—å•ä»· */
function autoPrice(){
  const usd=+els.airdropUSD.value||0;
  if(usd>0){
    els.tokenPrice.value=(usd/CONFIG.TOTAL_TOKENS).toFixed(6);
    els.airdropFmt.textContent='â‰ˆÂ '+fmt(usd/1e4)+'Â ä¸‡Â USD';
  }else els.airdropFmt.textContent='â€”';
}
autoPrice();

/* æ‹‰å– BNB å½“å‰ä»·æ ¼ï¼Œç¼“å­˜ 60â€¯s */
let lastPriceFetch=0;
async function getBNBPrice(){
  const now=Date.now();
  if(now-lastPriceFetch<CONFIG.PRICE_CACHE_MS) return +els.bnbPrice.value;
  try{
    const data=await fetchJSON('https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd');
    els.bnbPrice.value=data.binancecoin.usd;
    lastPriceFetch=now;
  }catch(e){/* ç½‘ç»œå¤±è´¥åˆ™ä¿æŒæ—§å€¼ */}
  return +els.bnbPrice.value;
}

/* è¯»å–é“¾ä¸Šä½™é¢ï¼ˆå•ä½ï¼šBNBï¼‰*/
async function fetchBalance(addr){
  const body=JSON.stringify({jsonrpc:'2.0',method:'eth_getBalance',params:[addr,'latest'],id:1});
  const opts={method:'POST',headers:{'Content-Type':'application/json'},body};
  const hex=await Promise.any(CONFIG.RPC_NODES.map(u=>fetchJSON(u,opts)))
            .then(r=>r.result)
            .catch(()=>'0x0');
  return Number(BigInt(hex)/10n**18n);   // è½¬æˆ BNB
}

/* æ¸²æŸ“ç»“æœ */
async function render(dep){
  const user=+els.userAmount.value||0;
  const price=+els.tokenPrice.value||0;
  const bnbUSD=await getBNBPrice();
  const target=CONFIG.TOTAL_TARGET_BNB;
  if(!(user&&price&&bnbUSD&&target&&dep)){els.resultBox.style.display='none';return;}

  const share=user/dep;
  const tokens=share*CONFIG.TOTAL_TOKENS;
  let principal=share*target;
  principal=Math.min(principal,user);
  const refund=Math.max(user-principal,0);
  const multi=dep/target;

  els.bnbBalance.textContent=fmt(dep,4);
  els.multiplier.textContent=fmt(multi,2);
  els.userInput.textContent=fmt(user,2);
  els.percent.textContent=fmt(share*100,4);
  els.basAmount.textContent=fmt(tokens,2);
  els.usdValue.textContent=fmt(tokens*price);
  els.principalBNB.textContent=fmt(principal,4);
  els.principalUSD.textContent=fmt(principal*bnbUSD);
  els.refundBNB.textContent=fmt(refund,4);
  els.resultBox.style.display='block';
}

/* æ‰‹åŠ¨ï¼å®šæ—¶åˆ·æ–° */
let refreshing=false,lastTap=0;
async function refresh(){
  if(Date.now()-lastTap<1400||refreshing)return;
  lastTap=Date.now(); refreshing=true;
  els.refreshBtn.disabled=true;
  els.refreshBtn.textContent='â³Â åˆ·æ–°ä¸­â€¦';
  els.errBanner.style.display='none';
  try{
    const weiBNB=await fetchBalance(els.targetAddress.value);
    await render(weiBNB);
    els.lastUpdateHint.textContent='æœ€åæ›´æ–°æ—¶é—´ï¼š'+new Date().toLocaleTimeString('zh-CN',{hour12:false});
  }catch(e){
    els.errBanner.textContent=e.message||'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•';
    els.errBanner.style.display='block';
  }finally{
    els.refreshBtn.disabled=false;
    els.refreshBtn.textContent='ğŸ”„Â åˆ·æ–°æ•°æ®';
    refreshing=false;
  }
}

/* å€’è®¡æ—¶ / è¿›åº¦æ¡ */
function tick(){
  const now=Date.now();
  if(now<CONFIG.START_TIME){
    els.countdownText.textContent='æ´»åŠ¨æœªå¼€å§‹';
    els.progressBar.style.width='0%';
  }else if(now>=CONFIG.END_TIME){
    els.countdownText.textContent='å·²ç»“æŸ';
    els.progressBar.style.width='100%';
    stopPoll();
    els.refreshBtn.disabled=true;
    els.refreshBtn.textContent='â¹Â å·²ç»“æŸ';
  }else{
    const diff=CONFIG.END_TIME-now;
    const txt=diff<3.6e6
      ?`${Math.floor(diff/6e4)}Â åˆ†Â ${Math.floor(diff%6e4/1e3)}Â ç§’`
      :`${Math.floor(diff/3.6e6)}Â å°æ—¶Â ${Math.floor(diff%3.6e6/6e4)}Â åˆ†`;
    els.countdownText.textContent='å‰©ä½™æ—¶é—´ï¼š'+txt;
    els.progressBar.style.width(((now-CONFIG.START_TIME)/(CONFIG.END_TIME-CONFIG.START_TIME)*100).toFixed(2)+'%');
  }
}

/* è½®è¯¢æ§åˆ¶ */
let poll=null,clock=null;
function startPoll(){
  if(!poll) poll=setInterval(refresh,CONFIG.REFRESH_INTERVAL);
  if(!clock) clock=setInterval(tick,1000);
}
function stopPoll(){
  clearInterval(poll); poll=null;
  clearInterval(clock); clock=null;
}

/* äº‹ä»¶ç»‘å®š */
document.addEventListener('visibilitychange',()=>document.hidden?stopPoll():startPoll());
els.refreshBtn.addEventListener('click',refresh);
window.addEventListener('load',()=>{refresh();tick();startPoll();});
window.addEventListener('beforeunload',()=>{
  stopPoll();
  document.removeEventListener('visibilitychange',()=>{});
});
</script>
</body>
</html>
