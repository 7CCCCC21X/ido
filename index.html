<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å¸å®‰ Web3 é’±åŒ… ç¬¬40 æœŸ ç‹¬å®¶ TGE Lab (LAB)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta name="color-scheme" content="light dark">
    <style>
        :root{
            --c-bg:#f9f9f9; --c-card:#fff; --c-text:#222; --c-sub:#6b7280;
            --c-primary:#0078d4; --c-primary-dark:#005fa3; --c-success:#16a34a;
            --c-error:#dc2626; --c-refund:#0284c7; --c-warn:#f59e0b;
        }
        @media(prefers-color-scheme:dark){
            :root{ --c-bg:#111827; --c-card:#1f2937; --c-text:#f3f4f6; --c-sub:#9ca3af }
        }
        *{box-sizing:border-box;margin:0}
        body{
            font-family:-apple-system,Segoe UI,PingFang SC,Helvetica,Arial,sans-serif;
            background:var(--c-bg);color:var(--c-text)
        }
        .container{
            max-width:760px;margin:40px auto;padding:34px;background:var(--c-card);border-radius:18px;
            box-shadow:0 10px 24px rgba(0,0,0,.08)
        }
        h2{color:var(--c-primary);text-align:center;margin-bottom:8px}
        /* åˆçº¦åœ°å€ä¸æ˜¾ç¤ºï¼ˆä»…ä¿ç•™ DOMï¼‰ */
        .subline{display:none}
        label{display:block;margin:14px 0 8px;font-weight:700}
        .note{font-size:13px;color:var(--c-sub);margin-left:4px}
        input,select{width:100%;padding:12px;font-size:15px;border:1px solid #ccc;border-radius:10px;background:var(--c-card);color:var(--c-text)}
        input[readonly]{background:linear-gradient(90deg,#f3f4f6,#fff);cursor:default}
        button{width:100%;padding:13px;font-size:16px;background:var(--c-primary);color:#fff;border:none;border-radius:10px;margin-top:18px;cursor:pointer;transition:background .2s}
        button:hover{background:var(--c-primary-dark)}
        .row{display:flex;gap:12px}
        .col{flex:1}
        .small{font-size:13px;color:var(--c-sub)}
        .progress-container{margin-top:22px}
        .progress-bg{background:#e5e7eb;height:14px;border-radius:10px;overflow:hidden}
        .progress-bar{background:var(--c-primary);height:100%;width:0%;transition:width .4s}
        .countdown{margin-top:6px;text-align:right;font-size:14px;color:var(--c-sub)}
        .result{margin-top:22px;padding:18px;border-radius:14px;border:1px solid #d1d5db;background:var(--c-bg)}
        .result p{margin:8px 0;font-size:15px;line-height:1.45}
        .highlight{font-weight:700}
        .success{color:var(--c-success);font-weight:700}
        .deduct{color:var(--c-error);font-weight:700}
        .refund{color:var(--c-refund);font-weight:700}
        .tutorial-link{display:block;margin-top:12px;text-align:center;font-weight:700;text-decoration:none;color:var(--c-primary)}
        .tutorial-link:hover{text-decoration:underline}
        /* å¸¦ LOGO çš„æ•™ç¨‹æ ·å¼ */
        .tutorial-link--icon{
            display:flex;align-items:center;justify-content:center;gap:8px;
        }
        .tutorial-link--icon .ico{
            width:18px;height:18px;line-height:0;display:inline-flex;color:var(--c-primary);
        }
        .updateHint{text-align:right;font-size:13px;color:var(--c-sub);margin-top:10px}
        .error-banner{display:none;margin-bottom:18px;padding:10px 14px;border-radius:10px;background:var(--c-error);color:#fff;font-size:14px}
        .footer{margin-top:28px;text-align:center;font-size:14px;color:var(--c-sub)}
        .footer a{color:var(--c-primary);text-decoration:none}
        .footer a:hover{text-decoration:underline}
        .priceBox{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-top:12px}
        .priceItem{flex:1;padding:10px;border-radius:10px;border:1px solid #e6edf3;background:linear-gradient(180deg,rgba(255,255,255,0.6),transparent)}
        .priceItem .v{font-weight:700;font-size:16px}
        .priceItem .t{font-size:12px;color:var(--c-sub);margin-top:6px}
        .countdownAuto{font-size:13px;color:var(--c-sub);margin-top:8px;text-align:center}
        .ended-banner{display:none;margin-top:14px;padding:12px;border-radius:10px;background:rgba(245,158,11,.08);border:1px solid var(--c-warn)}
        .muted{opacity:.55;pointer-events:none;user-select:none}
    </style>
</head>
<body>
    <div class="container">
        <div id="errBanner" class="error-banner"></div>
        <h2>å¸å®‰ Web3 é’±åŒ… ç¬¬40 æœŸ ç‹¬å®¶ TGE Lab (LAB)</h2>
        <!-- åˆçº¦åœ°å€ï¼ˆéšè—ï¼Œä»…å†…éƒ¨ä½¿ç”¨ï¼‰ -->
        <div class="subline">åˆçº¦ï¼š<a id="contractLink" href="#" target="_blank" rel="noopener">â€”</a></div>
        <input id="targetAddress" type="hidden" value="0x5029fA9818000abE8691B44B574079cc621afbA6">

        <div class="row">
            <div class="col">
                <label>æŠ•å…¥ BNB</label>
                <input id="userAmount" type="number" step="0.01" value="3" min="0">
            </div>
            <div class="col">
                <label>åˆ·æ–°é¢‘ç‡ (ç§’)<span class="note">æœ€å°‘ 5 ç§’</span></label>
                <input id="refreshSec" type="number" step="1" value="10" min="5">
            </div>
        </div>

        <!-- ä»£å¸å•ä»·ï¼šç»™â€œå»ºè®®ä»· 0.1â€ï¼Œä½†å…è®¸æ‰‹åŠ¨ä¿®æ”¹ -->
        <label>ä»£å¸å•ä»· (USDT)<span class="note">å»ºè®® 0.1ï¼Œå¯æ‰‹åŠ¨ä¿®æ”¹</span></label>
        <input id="tokenPrice" type="number" step="0.000001" value="0.100000" min="0">

        <!-- é¢„è®¡ç©ºæŠ•æ€»é¢ï¼šæŒ‰å•ä»· Ã— å‡ºå”®é‡è‡ªåŠ¨æ¨ç®—ï¼ˆåªè¯»ï¼‰ -->
        <label>é¢„è®¡ç©ºæŠ•æ€»é¢ (USDT)<span class="note">æ ¹æ®ç›˜å‰ä»·æ¨ç®—</span></label>
        <input id="airdropUSD" type="number" step="1" value="2000000" readonly>
        <div class="note" id="airdropFmt">â‰ˆ 200 ä¸‡ USDT</div>

        <div class="priceBox" id="priceBox" aria-hidden="false">
            <div class="priceItem">
                <div class="v" id="bnbPriceV">â€”</div>
                <div class="t">å½“å‰ BNB ç¾å…ƒä»·æ ¼ï¼ˆUSDï¼‰</div>
            </div>
            <div class="priceItem">
                <div class="v" id="labPriceV">0.100000 USDTï¼ˆå»ºè®®ï¼‰</div>
                <div class="t">LAB å»ºè®®ç›˜å‰ä»·ï¼ˆå¯æ”¹ï¼‰</div>
            </div>
        </div>

        <div class="countdownAuto" id="autoRefreshCountdown">ä¸‹æ¬¡è‡ªåŠ¨åˆ·æ–°ï¼šâ€” ç§’</div>

        <button id="refreshBtn">ğŸ”„ æ‰‹åŠ¨åˆ·æ–°</button>
        <div class="updateHint" id="lastUpdateHint">â€”</div>

        <!-- æ•™ç¨‹ï¼šæå‰æˆæƒå¸¦ LOGOï¼Œä¿ç•™ä¸¤æ¡å€Ÿ BNB æ•™ç¨‹ -->
        <a class="tutorial-link tutorial-link--icon" href="https://x.com/0xXIAOc/status/1977978328146731092" target="_blank" rel="noopener">
            <span class="ico" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18" xmlns="http://www.w3.org/2000/svg" role="img" focusable="false">
                    <path d="M12 2l7 4v6c0 5.2-3.7 9.7-7 10-3.3-.3-7-4.8-7-10V6l7-4z"/>
                    <path d="M10.2 13.8l-2.2-2.2 1.4-1.4 0.8 0.8 3.8-3.8 1.4 1.4-4.6 4.6c-.2.2-.6.2-.8 0z" fill="#fff"/>
                </svg>
            </span>
            æå‰æˆæƒæ•™ç¨‹
        </a>
        <a class="tutorial-link" href="https://x.com/0xXIAOc/status/1929136552757830056" target="_blank" rel="noopener">ğŸ’¡ é“¾ä¸Šå€ŸBNBæ•™ç¨‹</a>
        <a class="tutorial-link" href="https://x.com/0xXIAOc/status/1977584958295392288" target="_blank" rel="noopener">ğŸ’¡ äº¤æ˜“æ‰€å€ŸBNBæ•™ç¨‹</a>

        <div class="progress-container" id="progressSection">
            <div class="progress-bg"><div class="progress-bar" id="progressBar"></div></div>
            <div class="countdown" id="countdownText">å€’è®¡æ—¶åŠ è½½ä¸­â€¦</div>
        </div>

        <div class="result" id="resultBox" hidden>
            <p>ğŸ“¦ å½“å‰åœ°å€ BNB ä½™é¢ï¼š<span class="highlight" id="bnbBalance">â€”</span></p>
            <p>ğŸ¯ å‹Ÿé›†ç›®æ ‡ï¼š<span class="highlight" id="targetBNBShow">â€”</span> BNB</p>
            <p>ğŸ”¥ è¶…å‹Ÿå€æ•°ï¼š<span class="highlight" id="multiplier">â€”</span></p>
            <p>ğŸ’° å‡ºå”®ä»£å¸æ•°é‡ï¼š20,000,000 æš LABï¼ˆå æ€»ä¾›åº”é‡çš„ 2%ï¼‰</p><hr>
            <p>ğŸš€ ä½ æŠ•å…¥ <span class="highlight" id="userInput">â€”</span> BNBï¼ˆå æ¯” <span class="highlight" id="percent">â€”</span>%ï¼‰<br>
                å¯è·å¾— <span class="success" id="tokenAmt">â€”</span> æš LAB â‰ˆ <span class="success" id="usdValue">â€”</span></p>
            <p>ğŸ’¸ å®é™…æ‰£æ¬¾ï¼š<span class="deduct" id="principalBNB">â€”</span> BNB â‰ˆ <span class="deduct" id="principalUSD">â€”</span></p>
            <p>ğŸ”„ é€€å› BNBï¼š<span class="refund" id="refundBNB">â€”</span> BNB</p>
        </div>

        <div class="ended-banner" id="endedMsg">æ´»åŠ¨å·²ç»“æŸï¼ŒåŠ¨æ€æ•°æ®å·²éšè—ã€‚</div>
    </div>

    <div class="footer">ä½œè€…ï¼š<a href="https://x.com/0xXIAOc" target="_blank">@0xXIAOc</a></div>

    <script>
        // ==== é…ç½®ï¼ˆLAB ä¸“åœºï¼‰====
        const CONFIG = {
            TOTAL_TARGET_BNB: 153.47,                 // å‹Ÿé›†BNBæ•°é‡
            TOTAL_TOKENS: 20_000_000,                 // å‡ºå”®ä»£å¸æ•°é‡ï¼ˆLABï¼‰
            // æ—¶é—´ï¼š10æœˆ14æ—¥ 17:30-19:30ï¼ˆåŒ—äº¬æ—¶é—´ï¼ŒUTC+8ï¼‰
            START_TIME: new Date('2025-10-14T17:30:00+08:00'),
            END_TIME:   new Date('2025-10-14T19:30:00+08:00'),
            REFRESH_INTERVAL: 10_000,
            PRICE_CACHE_MS: 60_000,
            PRICE_APIS: [
                'https://api.coingecko.com/api/v3/simple/price?ids=binancecoin&vs_currencies=usd',
                'https://min-api.cryptocompare.com/data/price?fsym=BNB&tsyms=USD'
            ],
            RPC_NODES: [
                'https://bsc-dataseed.binance.org/',
                'https://bsc-dataseed1.defibit.io/',
                'https://bsc-dataseed4.defibit.io/',
                'https://bsc-dataseed1.ninicoin.io/'
            ],
            SUGGESTED_LAB_PRICE: 0.1                   // å»ºè®®ç›˜å‰ä»·ï¼ˆå¯è¢«æ‰‹åŠ¨è¦†ç›–ï¼‰
        };

        // ==== DOM å¿«æ·å¼•ç”¨ ====
        const $ = id => document.getElementById(id);
        const els = {
            userAmount: $('userAmount'),
            tokenPrice: $('tokenPrice'),
            airdropUSD: $('airdropUSD'),
            airdropFmt: $('airdropFmt'),
            refreshSec: $('refreshSec'),
            refreshBtn: $('refreshBtn'),
            lastUpdateHint: $('lastUpdateHint'),
            bnbBalance: $('bnbBalance'),
            multiplier: $('multiplier'),
            userInput: $('userInput'),
            percent: $('percent'),
            tokenAmt: $('tokenAmt'),
            usdValue: $('usdValue'),
            principalBNB: $('principalBNB'),
            principalUSD: $('principalUSD'),
            refundBNB: $('refundBNB'),
            resultBox: $('resultBox'),
            countdownText: $('countdownText'),
            progressBar: $('progressBar'),
            progressSection: $('progressSection'),
            errBanner: $('errBanner'),
            targetAddress: $('targetAddress'),
            targetBNBShow: $('targetBNBShow'),
            bnbPriceV: $('bnbPriceV'),
            labPriceV: $('labPriceV'),
            priceBoxDiv: $('priceBox'),
            autoRefreshCountdown: $('autoRefreshCountdown'),
            endedMsg: $('endedMsg'),
            contractLink: $('contractLink') // ä»å­˜åœ¨ä½†éšè—
        };

        // ==== å·¥å…· ====
        const fmt = (n, d = 0) => Number(n).toLocaleString('zh-CN', { maximumFractionDigits: d });
        const fetchJSON = (u, o) => fetch(u, o).then(r => r.json());
        const TZ = 'Asia/Shanghai';
        const isEnded = () => Date.now() >= CONFIG.END_TIME.getTime();

        // â€”â€” æ¨ç®—é¢„è®¡ç©ºæŠ•ï¼ˆTOTAL_TOKENS * tokenPriceï¼‰
        function computeAirdropUSDFromTokenPrice(tokenPrice){
            const tokens = CONFIG.TOTAL_TOKENS || 0;
            const price = Number(tokenPrice) || 0;
            return tokens * price;
        }

        function computePrice(){
            const tokenP = +els.tokenPrice.value || 0;
            const computedAirdrop = computeAirdropUSDFromTokenPrice(tokenP);
            els.airdropUSD.value = Math.round(computedAirdrop);
            els.airdropFmt.textContent = computedAirdrop ? 'â‰ˆ ' + fmt(computedAirdrop/1e4) + ' ä¸‡ USDT' : 'â€”';
        }

        // BNB ç¾å…ƒä»·ï¼ˆå¸¦ç¼“å­˜ï¼‰
        async function getBNBPrice(){
            const cache = JSON.parse(localStorage.getItem('bnbP')||'{}');
            if(cache.v && Date.now()-cache.t < CONFIG.PRICE_CACHE_MS) return cache.v;
            for(const url of CONFIG.PRICE_APIS){
                try{
                    const d = await fetchJSON(url);
                    const usd = d?.binancecoin?.usd || d?.USD;
                    if(usd){
                        localStorage.setItem('bnbP', JSON.stringify({v:usd, t:Date.now()}));
                        return usd;
                    }
                }catch{}
            }
            return 0;
        }

        // æ›´æ–° BNB ä¸â€œå»ºè®®ä»·â€å±•ç¤ºï¼ˆä¸ä¼šè¦†ç›–ä½ æ‰‹åŠ¨è¾“å…¥çš„å•ä»·ï¼‰
        async function updateLabPriceDisplay(){
            try{
                const bnbUSD = await getBNBPrice();
                els.bnbPriceV.textContent = bnbUSD ? '$' + fmt(bnbUSD,4) : 'â€”';

                const suggested = CONFIG.SUGGESTED_LAB_PRICE;
                els.labPriceV.textContent = fmt(suggested,6) + ' USDTï¼ˆå»ºè®®ï¼‰';

                // ä»…åœ¨æœªæ‰‹åŠ¨ä¿®æ”¹è¿‡æ—¶ï¼Œæ‰ç”¨å»ºè®®ä»·å›å¡«è¾“å…¥æ¡†
                if(!els.tokenPrice.dataset.userEdited){
                    els.tokenPrice.value = suggested.toFixed(6);
                }
                computePrice();
            }catch(e){
                console.error('updateLabPriceDisplay error', e);
            }
        }

        // é“¾ä¸Šä½™é¢ï¼ˆBNBï¼‰
        async function fetchBalance(addr){
            if(!addr) return 0;
            const body = JSON.stringify({jsonrpc:'2.0',method:'eth_getBalance',params:[addr,'latest'],id:1});
            for(const node of CONFIG.RPC_NODES){
                try{
                    const {result} = await fetchJSON(node,{method:'POST',headers:{'Content-Type':'application/json'},body});
                    return Number(BigInt(result)/10n**18n);
                }catch{}
            }
            return 0;
        }

        // ========== è‡ªåŠ¨åˆ·æ–°è®¡æ—¶ ==========
        let refreshIntervalMs = Math.max(+els.refreshSec.value||10,5) * 1000;
        let nextRefreshSeconds = Math.floor(refreshIntervalMs / 1000);
        let refreshTimerId = null;
        let countdownTimerId = null;

        function startAutoRefreshTimers(){
            if(refreshTimerId) clearInterval(refreshTimerId);
            if(countdownTimerId) clearInterval(countdownTimerId);
            refreshTimerId = setInterval(()=>{ refresh(false); resetCountdown(); }, refreshIntervalMs);
            nextRefreshSeconds = Math.ceil(refreshIntervalMs / 1000);
            updateCountdownDisplay();
            countdownTimerId = setInterval(()=>{
                nextRefreshSeconds--;
                if(nextRefreshSeconds <= 0){
                    nextRefreshSeconds = Math.ceil(refreshIntervalMs / 1000);
                }
                updateCountdownDisplay();
            }, 1000);
        }

        function resetCountdown(){
            refreshIntervalMs = Math.max(+els.refreshSec.value||10,5) * 1000;
            nextRefreshSeconds = Math.ceil(refreshIntervalMs / 1000);
            updateCountdownDisplay();
        }

        function updateCountdownDisplay(){
            els.autoRefreshCountdown.textContent = `ä¸‹æ¬¡è‡ªåŠ¨åˆ·æ–°ï¼š${nextRefreshSeconds} ç§’`;
        }

        // ========== ä¸»æ¸²æŸ“ä¸åˆ·æ–° ==========
        let latestDep = 0;
        async function render(dep = latestDep){
            if(isEnded()){ applyEndState(); return; }

            latestDep = dep;
            await updateLabPriceDisplay();
            computePrice();

            const user = +els.userAmount.value || 0;
            const price = +els.tokenPrice.value || 0;
            const bnbUSD = await getBNBPrice();
            const target = CONFIG.TOTAL_TARGET_BNB;

            els.targetBNBShow.textContent = target ? fmt(target,2) : 'â€”';

            if(!(user && price && bnbUSD && dep && target)){
                els.resultBox.hidden = true;
                return;
            }

            const share = user/dep;
            const tokens = share*CONFIG.TOTAL_TOKENS;
            const principal = Math.min(share*target, user);
            const refund = Math.max(user-principal, 0);
            const multi = dep/target;

            els.bnbBalance.textContent = fmt(dep,4);
            els.multiplier.textContent = fmt(multi,2);
            els.userInput.textContent = fmt(user,2);
            els.percent.textContent = fmt(share*100,4);
            els.tokenAmt.textContent = fmt(tokens,2);
            els.usdValue.textContent = fmt(tokens*price,2);
            els.principalBNB.textContent = fmt(principal,4);
            els.principalUSD.textContent = fmt(principal*bnbUSD,2);
            els.refundBNB.textContent = fmt(refund,4);
            els.resultBox.hidden = false;
        }

        let refreshing=false;
        async function refresh(manual=false){
            if(refreshing) return;
            if(isEnded()){ applyEndState(); return; }

            refreshing=true;
            els.refreshBtn.disabled=true;
            if(manual) els.errBanner.style.display='none';
            try{
                await getBNBPrice();
                await updateLabPriceDisplay();
                const dep = await fetchBalance(els.targetAddress.value);
                await render(dep);
                els.lastUpdateHint.textContent='æœ€åæ›´æ–°ï¼š'+new Date().toLocaleTimeString('zh-CN',{hour12:false});
            }catch(e){
                if(manual){
                    els.errBanner.textContent=e?.message||'ç½‘ç»œé”™è¯¯';
                    els.errBanner.style.display='block';
                }
                console.error(e);
            }finally{
                els.refreshBtn.disabled=false;
                refreshing=false;
            }
        }

        // === è¿›åº¦æ¡ & å€’è®¡æ—¶ï¼ˆæ´»åŠ¨è¿›åº¦ï¼‰===
        function formatRangeForCN(st, et){
            const getNum = (date, opt) =>
                new Intl.DateTimeFormat('zh-CN', { timeZone: TZ, ...opt })
                    .format(date).replace(/\D/g, '');
            const m = getNum(st, { month: 'numeric' });
            const d = getNum(st, { day: 'numeric' });
            const tFmt = new Intl.DateTimeFormat('zh-CN', { timeZone: TZ, hour: '2-digit', minute: '2-digit', hour12: false });
            const ts = tFmt.format(st);
            const te = tFmt.format(et);
            return `${m}æœˆ${d}æ—¥ ${ts}-${te}ï¼ˆåŒ—äº¬æ—¶é—´ï¼‰`;
        }

        let endStateApplied = false;
        function applyEndState(){
            if(endStateApplied) return;
            endStateApplied = true;
            if(refreshTimerId) clearInterval(refreshTimerId);
            if(countdownTimerId) clearInterval(countdownTimerId);
            els.resultBox.hidden = true;
            els.priceBoxDiv.style.display = 'none';
            els.autoRefreshCountdown.style.display = 'none';
            els.refreshBtn.classList.add('muted');
            els.refreshBtn.disabled = true;
            els.refreshSec.disabled = true;
            els.userAmount.disabled = true;
            els.endedMsg.style.display = 'block';
            els.countdownText.textContent = 'å·²ç»“æŸ';
        }

        function tick(){
            const stMs = CONFIG.START_TIME.getTime();
            const etMs = CONFIG.END_TIME.getTime();
            const nowMs = Date.now();
            const rangeStr = formatRangeForCN(CONFIG.START_TIME, CONFIG.END_TIME);

            if(nowMs < stMs){
                els.countdownText.textContent = `æ´»åŠ¨æœªå¼€å§‹ï¼š${rangeStr}`;
                els.progressBar.style.width = '0%';
                return;
            }
            if(nowMs >= etMs){
                els.progressBar.style.width = '100%';
                applyEndState();
                return;
            }
            const diff = etMs - nowMs;
            const hours = Math.floor(diff/3.6e6);
            const mins  = Math.floor((diff%3.6e6)/6e4);
            const secs  = Math.floor((diff%6e4)/1e3);
            const txt   = hours>0 ? `${hours} å°æ—¶ ${mins} åˆ†` : (mins>0 ? `${mins} åˆ† ${secs} ç§’` : `${(diff/1e3).toFixed(1)} ç§’`);
            els.countdownText.textContent = `å‰©ä½™æ—¶é—´ï¼š${txt}`;
            const pct = ((nowMs - stMs) / (etMs - stMs) * 100);
            els.progressBar.style.width = (pct>100?100: pct<0?0:pct).toFixed(2) + '%';
        }

        // ========== å¯åŠ¨ / äº‹ä»¶ç»‘å®š ==========
        function applyInterval(){
            const sec = Math.max(+els.refreshSec.value||10,5);
            refreshIntervalMs = sec * 1000;
            if(refreshTimerId) clearInterval(refreshTimerId);
            if(countdownTimerId) clearInterval(countdownTimerId);
            if(!isEnded()){
                startAutoRefreshTimers();
            }
        }

        // å…è®¸æ‰‹åŠ¨ä¿®æ”¹â€œä»£å¸å•ä»·â€ï¼Œå¹¶æ ‡è®°å·²æ‰‹åŠ¨è¦†ç›–
        els.tokenPrice.addEventListener('input', ()=>{
            els.tokenPrice.dataset.userEdited = '1';
            computePrice();
            render();
        });

        els.userAmount.addEventListener('input',()=>render());
        els.refreshSec.addEventListener('change',applyInterval);
        els.refreshBtn.addEventListener('click',async ()=>{ await refresh(true); resetCountdown(); });
        document.addEventListener('visibilitychange',()=>document.hidden? (clearInterval(refreshTimerId), clearInterval(countdownTimerId)) : (!isEnded() && startAutoRefreshTimers()));

        window.addEventListener('load', async ()=>{
            // åˆçº¦é“¾æ¥ï¼ˆéšè—æ˜¾ç¤ºï¼Œä½†ä¿æŒå¯ç”¨ï¼‰
            const addr = els.targetAddress.value;
            if(els.contractLink){
                els.contractLink.href = `https://bscscan.com/address/${addr}`;
                els.contractLink.textContent = addr;
            }

            // åˆå§‹æ ¹æ®å»ºè®®ä»·è®¡ç®—
            computePrice();
            if(!isEnded()){
                startAutoRefreshTimers();
            }
            await refresh();
            setInterval(tick, 500);
            // å®šæœŸåˆ·æ–° BNB ä»·æ ¼ä¸å»ºè®®ä»·å±•ç¤ºï¼ˆä¸ä¼šè¦†ç›–æ‰‹åŠ¨è¾“å…¥ï¼‰
            setInterval(()=>{ if(!isEnded()) updateLabPriceDisplay(); }, CONFIG.PRICE_CACHE_MS);
        });
    </script>
</body>
</html>
